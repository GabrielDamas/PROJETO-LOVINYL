<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="./css/style-dashboard.css">

    <script src="./js/login.js"></script>
    <script src="./js/funcoes.js"></script>
    <script src="./pagina-disco1.html"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600&display=swap" rel="stylesheet">

    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
</head>

<body onload="validarSessao()">
    <section class="sidebar">
        <div class="sidebar-logo">
            <h1><span>LOVINYL</span></h1>
        </div>

        <div class="sidebar-menu">
            <ul>
                <li><a href="./dashboard.html" class="ativo">INICIO</a></li>
                <li><a href="./biblioteca.html">NOSSOS DISCOS</a></li>
                <li><a href="./formulario.html">SUGESTÕES</a></li>
            </ul>
        </div>
    </section>

    <section class="conteudo">
        <header>
            <h2>
                DASHBOARD
            </h2>

            <div class="search-box">
                <input type="search" placeholder="Procure um disco">
            </div>

            <div class="user-box">
                <h3>Olá,<b id="b_usuario"></b></h3>
                <ul>
                    <li><a onclick="limparSessao()">Log Out</a></li>
                </ul>
            </div>
        </header>

        <main>
            <h1>VEJA ABAIXO SUAS MUSICAS MAIS OUVIDAS!</h1>
            <div class="botoes">
                <button onclick="bt_dado(1)" class="bt-grafico">DIA</button>
                <button onclick="bt_dado(2)" class="bt-grafico">MES</button>
                <button onclick="bt_dado(3)" class="bt-grafico">ANO</button>
            </div>

            <div class="grafico">
                <div class="conteudo-grafico">
                    <canvas id="MyChart" width="400" height="400"></canvas>
                </div>
            </div>


            <div id="div_modal" class="div-modal">
                <div id="modal_backdrop" onclick="fecharModal()" class="modal-backdrop">
                </div>
                <div id="modal_container" class="modal-container">
                    <button onclick="fecharModal()">fechar modal</button>
                </div>
            </div>
        </main>
    </section>
</body>

</html>

<script>
    let proximaAtualizacao;

    window.onload = bt_dado(1);

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    // só altere aqui se souber o que está fazendo!
    function plotarGrafico(resposta, idContagem) {
        console.log('iniciando plotagem do gráfico...');

        var dados = {
            labels: [],
            datasets: [{
                yAxisID: 'y-temperatura',
                label: 'Temperatura',
                borderColor: '#FFF',
                backgroundColor: '#32b9cd8f',
                fill: true,
                data: []
            }]
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
            dados.datasets[1].data.push(registro.temperatura);
        }

        console.log(JSON.stringify(dados));

        var ctx = canvas_grafico.getContext('2d');
        window.grafico_linha = Chart.Line(ctx, {
            data: dados,
            //Configurações do gráfico
            options: {
                responsive: true,
                animation: {
                    duration: 500
                },
                hoverMode: 'index',
                stacked: false,
                title: {
                    display: true,
                    text: 'Histórico recente de umidade/temperatura'
                },
                scales: {
                    yAxes: [{
                        type: 'linear',
                        display: false,
                        position: 'right',
                        id: 'y-umidade',
                        ticks: {
                            beginAtZero: true,
                            max: 100,
                            min: 0
                        },

                        gridLines: {
                            drawOnChartArea: false,
                        },
                    }],
                }
            }
        });

        function sendData() {
            var http = new XMLHttpRequest();
            http.open('POST', 'http://localhost:3000/api/sendData', false);
            http.send(null);
        }
    }

    // criando um novo objeto, contendo o tipo, os dados
    // e as opções que o gráfico terá.
    let ctx = document.getElementById('myChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'bar',
        // O objeto data possui os valores dispostos no gráfico
        type: 'bar',
        data: {
            labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
</script>


</script>